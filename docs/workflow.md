# BYR Docs 工作流程

本篇文档介绍的是 BYR Docs 的工作流程。

我们欢迎所有同学为本项目贡献文件；但我们也必须对文件/元信息的质量进行审核，以防鱼目混珠。

管理员会把不合格的文件打回，相应的 Pull Request 也会遭拒。因此，为避免不必要的麻烦，请上传者严格遵照本流程行事。

## BYR Docs 目录结构

BYR Docs 文件夹包含以下部分。

```shell
/path/to/BYRDOCS/ # 如 ~/BYRDOCS
├── .cache # 必需
├── README.md # 非必需，但会自动生成
├── archive # 必需
├── completion # 非必需
├── stockpile # 必需
└── tui # 非必需
```

其中标注为 `必需` 的部分，是在 TUI 程序进行初始化之际就生成的，**请勿轻易改动**。

- `.cache` 是一个 **缓存** 目录。下载自 BYR Docs 中的文件将暂存于此。如果一段时间内未被使用，程序将自动清理这些文件——无需手动操作。
- [`archive`](https://github.com/byrdocs/byrdocs-archive) 目录保存所有文件的 **元信息**。在编辑元信息前，请先 fork 此仓库到你自己的 GitHub 账号中，修改完成后再向本仓库提 Pull Request。
- [`stockpile`](https://github.com/byrdocs/byrdocs-scripts) 是 **文件暂存库** 也是 **脚本库**。这里保存了一些处理文件时可能用到的脚本。与 `.cache` 不同，它保存的是「你计划上传到 BYR Docs 中的文件」，而不是从 BYRDOCS 中下载的文件。

而 `非必需` 的部分不会自动生成。如有需要，你可以手动 `git clone` 它们。

- [`completion`](https://github.com/byrdocs/byrdocs-completion) 是 BYR Docs 的子项目，旨在为部分考题编辑答案，或者重新排版一些质量不佳的考题文件。如果你有兴趣参与这个子项目，欢迎提 Pull Request。
- [`tui`](https://github.com/byrdocs/byrdocs-tui) 是 BYR Docs 的集成命令行工具。如果你有意向帮我们改进功能、改良 UI 或者提供新的 themes，欢迎提 Pull Request。

## 理解工作流程

### 理解 [byrdocs.org](https://byrdocs.org)

本项目的网址为 `https://byrdocs.org`。为避免教育资源被滥用，本站只允许北京邮电大学在校师生访问。

如果你处在北邮校园网环境下，那么~~不出意外的话~~你可以直接访问此网站并下载其中的文件；否则，你需要使用 [北京邮电大学统一身份认证](https://auth.bupt.edu.cn/authserver/login) 来核实身份。

你上传的文件将按照其 md5sum 来重命名，并存储为 `https://byrdocs.org/files/${file}`，例如：

- https://byrdocs.org/files/dd6388976e48a6ce2f8a30355acfcba0.pdf
- https://byrdocs.org/files/62b43f8fbed2bb3087f2afc96fd89b0f.zip

文件 URL 的结构就是这样简单。所以，如果你预先知道了某个文件的 md5sum（及其后缀名），你就可以直接通过 URL 来下载它，完全不需要通过 BYR Docs 网站搜索再下载。

> [!NOTE]
> 我们仍然推荐你通过 BYR Docs 下载文件，因为通过 BYR Docs 下载的文件会自动重命名；而通过 URL 直接下载的文件不会重命名，仍使用 md5sum 作为文件名，不直观。

你上传的文件也是如此。通过 `byrdocs-tui` 上传的文件会重命名，并存入对应的目录中，然后其他人可以通过 URl 直接下载它。但是注意，如果不通过审核，这些文件是无法搜索到的。

### 理解 文件收录规则

我们人为地将文件区分成三个类别（type）：书籍（book）、试题（test）、资料（doc）。

- **书籍** 必须满足以下条件
  - 是书籍（课件、笔记等形式不符合书籍这一定义）
  - 是PDF格式的电子书（若为EPUB等其它格式，请考虑转换为PDF）
  - 是正式出版物（以个人/团体名义公开发表，但未经出版的书籍不属于此类）
  - 是教育资源（小说、散文、漫画不属于此类，除非有足够充分的证据证明它是教育资源）
- **试题** 必须满足以下条件
  - 是PDF格式的电子资料（若为纸质资料，可自行扫描、交由本团队扫描，或通过 [考题补完计划](https://github.com/byrdocs/byrdocs-completion) 制作电子版
  - 来自北京邮电大学（不可以是外校试题）
  - 是期中/期末考试题（不可以是月考、随堂作业等阶段性试题）
  - 必须是一套实际考过的真题，正常考或缓考均可（不可以是题库、模拟卷等。即使其中的大多数题目真的出现在真题中也不行）
- **资料** 可以认为是以上两类的补集，不符合以上两类要求的文件可以算作此类，但是仍需满足以下条件
  - 是PDF或ZIP格式（如不是，可考虑自行制作ZIP格式再提交）
  - 是教育资源（学校的培养方案、规章通知等不属于此类）
  - 必须能够对应到至少一门课程（否则就是无关资料）
  - 必须与课程学习、考试复习相关（竞赛资料，例如大学生数学竞赛、大学生英语竞赛的相关资料不应收录）

一个文件即便符合以上条件，也有可能因为质量不过关而遭拒。

- 文件模糊不清晰，影响正常阅读。*请自行想办法解决。*
- 文件有明显的缺页、重页、页面乱序问题，影响正常阅读。*请自行收集缺页，删除重页或调整页面顺序。*
- 文件杂揉（比如，多套题目合并到了同一个PDF文件中）。*请自行拆分为多个PDF，再分别提交。*
- 缺失封面（说来话长，见[理解 文件封面](#理解-文件封面)）

### 理解 文件元信息

为了方便检索，我们必须为每个文件录入一些元信息，比如名称、学科、版本等。

每种类别的资料都有各自的特征，所以不同类别的信息都有不同的元信息格式。你必须按照规定的格式来填写文件元信息。

本项目的元信息使用 `.yml` 文件保存。下面的三个例子详细解释了不同类别的信息格式：

- 作为「书籍」的 [06fa27d50ba4a4baae1b665ea48fd677.yml](../assets/06fa27d50ba4a4baae1b665ea48fd677.yml)
- 作为「试题」的 [154a930358251fe7bf774dd194bd9a00.yml](../assets/154a930358251fe7bf774dd194bd9a00.yml)
- 作为「资料」的 [3d6fa4f7305fb91e9c014e468037310c.yml](../assets/3d6fa4f7305fb91e9c014e468037310c.yml)

### 理解 文件去重与比较

狭义上的去重就是按 md5sum 来去重。这种程度的去重可以直接通过程序做到，你无需担心。

真正麻烦的在于广义上的去重：同一本书有若干不同的PDF，每个文件的质量都不同；同样是一份试题，有一版只有原题，有一版既有原题又有答案；同样的两份资料，领域相同，但内容又各有异同，只有部分重复……

这些情况实在太复杂，这里只列举一些常见的情况：

#### 书籍的重复问题

在两本书均没有质量问题（比如缺页漏页，或者很糟糕的清晰度）的前提下，我们有以下取舍指标：

- 若某本书的清晰度高于另一本，那么我们更倾向于选择前者。（这里也需要澄清一个误区，PDF的大小与它的清晰度没有必然关联）
- 若某本书有封面而另一本书没有，那么我们更倾向于选择前者（可以减少自行添加封面的麻烦）。
- 若某本书有完善的书签（bookmark）而另一本书没有，那么我们更倾向于选择前者。

#### 试题的重复问题

若二者没有内容上的冲突，最多只有包含关系，那么当然以保留全部内容为佳。

- 若一份是原题，一份是答案，虽然不重复，也建议将其合并成同一个文件，这样方便用户一次性下载原题和答案。
- 若其中一份仅有原题，而另一份既有原题又有答案，那么最好把两者合并，前者在前。（因为很多用户可能希望先做一遍再对答案）
- 若其中一份仅有答案，而另一份既有原题又有答案，那么前者无需保留，直接删除即可。

还有一些情况是：试题所指示的年份和科目都完全相同，但是内容基本不一致。这种重复在某些情形下是合理的——

- 正常考和补考的题目不相同；
- 不同学院的考卷不相同；
- 为避免作弊，使用了多份考卷进行考试（貌似只有疫情时期存在过这种情况）；

总之，试题的去重需要考虑的东西比较多，恐怕不能给出一个确定的标准。

#### 资料的重复问题

~~便宜行事~~

### 理解 文件封面

为了方便用户查找文件，BYR Docs 为每个PDF文件都制作了一份封面。这样一来，读者找书时，只需看一眼封面图就可以从众多同名书籍中找到自己想要的那本。

简而言之，我们提取封面的规则是：提取PDF文件的第一页，并通过一些必要的处理，将其转换成符合要求的JPG和WEBP文件。这一系列操作将在文件上传之后由服务器完成，所以你无需担心。

但是有一个问题：**有些电子书没有封面页**！

这时你需要上网找到这本电子书对应的封面页，并将其添加到这本书的第一页。

如果你使用 Linux 或 MacOS，可以通过 [BYR Docs](https://github.com/byrdocs/byrdocs-scripts) 的脚本来进行添加封面的操作。

再次提醒，BYR Docs不接受缺少封面的文件。
